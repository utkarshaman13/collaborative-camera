const express=require('express');const http=require('http');const socketIO=require('socket.io');const path=require('path');const app=express();const server=http.createServer(app);const io=socketIO(server,{cors:{origin:"*",methods:["GET","POST"]}});const PORT=process.env.PORT||3000;app.use(express.static(path.join(__dirname,'../client')));const users=new Map();const operations=[];const redoStack=[];io.on('connection',(socket)=>{console.log(`âœ… User connected: ${socket.id}`);socket.on('join',(data)=>{const user={id:socket.id,username:data.username,color:data.color};users.set(socket.id,user);socket.emit('init',{users:Array.from(users.values()),operations:operations});socket.broadcast.emit('userJoined',user);console.log(`ðŸ‘‹ ${data.username} joined`)});socket.on('draw',(data)=>{const operation={...data,userId:socket.id,timestamp:Date.now()};operations.push(operation);redoStack.length=0;socket.broadcast.emit('remoteDrawing',operation)});socket.on('cursor',(data)=>{socket.broadcast.emit('remoteCursor',{...data,userId:socket.id})});socket.on('undo',()=>{if(operations.length>0){const operation=operations.pop();redoStack.push(operation);io.emit('remoteUndo',{userId:socket.id,timestamp:Date.now()})}});socket.on('redo',()=>{if(redoStack.length>0){const operation=redoStack.pop();operations.push(operation);io.emit('remoteRedo',{userId:socket.id,timestamp:Date.now()})}});socket.on('clear',()=>{operations.length=0;redoStack.length=0;io.emit('remoteClear',{userId:socket.id,timestamp:Date.now()})});socket.on('disconnect',()=>{const user=users.get(socket.id);if(user){console.log(`ðŸ‘‹ ${user.username} disconnected`);users.delete(socket.id);socket.broadcast.emit('userLeft',{userId:socket.id})}})});server.listen(PORT,()=>{console.log(`ðŸš€ Server running on http://localhost:${PORT}`);console.log(`ðŸ“‚ Serving files from: ${path.join(__dirname,'../client')}`)}); 