class WebSocketClient{constructor(){this.socket=null;this.connected=false;this.callbacks={};this.userId=null;this.username=null;this.reconnectAttempts=0;this.maxReconnectAttempts=5}connect(username){return new Promise((resolve,reject)=>{try{if(typeof io==='undefined'){reject(new Error('Socket.io library not loaded'));return}const serverUrl=window.location.origin;console.log('Connecting to:',serverUrl);this.socket=io(serverUrl,{transports:['websocket','polling'],reconnection:true,reconnectionDelay:1000,reconnectionDelayMax:5000,reconnectionAttempts:5});this.username=username;this.socket.on('connect',()=>{console.log('‚úÖ Connected:',this.socket.id);this.connected=true;this.userId=this.socket.id;this.reconnectAttempts=0;this.socket.emit('join',{username:this.username,color:this.getRandomColor()})});this.socket.on('init',(data)=>{console.log('üì¶ Init:',data);this.emit('init',data);resolve()});this.socket.on('userJoined',(data)=>{console.log('üëã Joined:',data);this.emit('userJoined',data)});this.socket.on('userLeft',(data)=>{console.log('üëã Left:',data);this.emit('userLeft',data)});this.socket.on('remoteDrawing',(data)=>this.emit('remoteDrawing',data));this.socket.on('remoteCursor',(data)=>this.emit('remoteCursor',data));this.socket.on('remoteClear',(data)=>this.emit('remoteClear',data));this.socket.on('remoteUndo',(data)=>this.emit('remoteUndo',data));this.socket.on('remoteRedo',(data)=>this.emit('remoteRedo',data));this.socket.on('disconnect',()=>{console.log('‚ùå Disconnected');this.connected=false;this.emit('disconnect');this.attemptReconnect()});this.socket.on('connect_error',(error)=>{console.error('‚ùå Error:',error.message);reject(error)});setTimeout(()=>{if(this.connected){console.log('‚úÖ Connected');resolve()}},2000)}catch(error){console.error('‚ùå Failed:',error);reject(error)}})}attemptReconnect(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;console.log(`üîÑ Reconnect attempt ${this.reconnectAttempts}`);setTimeout(()=>{if(this.socket){this.socket.connect()}},2000*this.reconnectAttempts)}}on(event,callback){if(!this.callbacks[event]){this.callbacks[event]=[]}this.callbacks[event].push(callback)}emit(event,data){if(this.callbacks[event]){this.callbacks[event].forEach(cb=>cb(data))}}send(event,data){if(this.socket&&this.connected){this.socket.emit(event,data)}else{console.warn('‚ö†Ô∏è Not connected:',event)}}getRandomColor(){const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7','#a29bfe'];return colors[Math.floor(Math.random()*colors.length)]}disconnect(){if(this.socket){this.socket.disconnect();this.connected=false}}}